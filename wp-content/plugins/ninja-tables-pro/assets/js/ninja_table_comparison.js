jQuery(document).ready((function(n){function t(t,a,i){if(0!==t.length){var d='<div class="comparison-table-wrapper"><table class="nt_comparison_table">';a.columns&&Array.isArray(a.columns)&&a.columns.forEach((function(n){"____editing____"!==n.key&&n.visible&&t.some((function(t){return t.rowData&&void 0!==t.rowData[n.key]&&""!==t.rowData[n.key]}))&&(d+='<tr><td class="field-name">'.concat(n.title||n.name,"</td>"),t.forEach((function(t){var o=t.rowData[n.key]||"",a=t.productId;if(n.original&&(n.key.includes("add_to_cart")||"woo_product_buy"===n.key))d+='<td class="field-value field-button" data-product-id="'.concat(a,'">').concat(o,"</td>");else if(n.key.includes("quantity")||"woo_product_quantity"===n.key)d+='<td class="field-value field-quantity" data-product-id="'.concat(a,'" data-column-key="').concat(n.key,'">1</td>');else if("woo_product_image"===n.key)d+='<td class="field-value field-image" data-product-id="'.concat(a,'" data-column-type="image">').concat(o,"</td>");else if(n.original&&"html"===n.original.data_type)if("custom"===n.original.source_type&&"featured_image"===n.original.wp_post_custom_data_source_type)d+='<td class="field-value field-image" data-product-id="'.concat(a,'" data-column-type="image" data-column-key="').concat(n.key,'">').concat(o,"</td>");else{var i='data-product-id="'.concat(a,'" data-column-key="').concat(n.key,'"');n.key.includes("price")?i+=' data-column-type="price"':(n.key.includes("variation")||n.key.includes("attribute"))&&(i+=' data-column-type="variations"'),d+='<td class="field-value field-html" '.concat(i,">").concat(o,"</td>")}else{var r=e(o);d+='<td class="field-value" data-product-id="'.concat(a,'" data-column-key="').concat(n.key,'">').concat(r,"</td>")}})),d+="</tr>")})),d+="</tbody></table></div>",n("#".concat(i," #comparison_table_container")).html(d),o(i,0,a)}}function o(t,o,e){var i=n("#".concat(t));function d(t){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=t.children(),e=a.data("product_id"),d=a.data("product_variations"),l=n(".ntb_attribute_select_"+e),s=l.data("attribute_name"),p=l.val(),u=a.data("product_type");if(o&&(e=t.data("product_id"),d=t.parents().children().data("product_variations"),u=t.parents().children().data("product_type"),s=t.data("attribute_name"),p=t.val(),l=i.find(".ntb_attribute_select_"+e)),"variable"===u){var f={},m={};l.each((function(t,a){var e=n(a),i=e.data("attribute_name"),r=e.data("attribute_label"),l=e.val(),u=e.data("default_options"),m=Object.keys(u),_=m;if(s!==i){for(var b=[],g=0;g<d.length;g++){var h=d[g];h.attributes[s]===p&&b.push(h.attributes[i])}_=c(b)?m:b}else _=m;e.empty(),e.append('<option value="">'+r+"</option>"),_.map((function(n,t){e.append('<option value="'+n+'">'+u[n]+"</option>")}));var w="";o&&!_.includes(l)?(e.val(""),w=""):(w=l,e.val(l)),f[i]=w})),m[e]=f,function(n,t,o){var a=o.find(".nt_add_to_cart_"+n),e=o.find(".selected_price_"+n),i=a.data("product_variations");i&&i.length>0&&i.map((function(o,a){if(r(o.attributes,t[n])){var e=JSON.parse(JSON.stringify(o));e.attributes=t[n],window.selectedVariations||(window.selectedVariations={}),window.selectedVariations[n]=e}})),window.selectedVariations&&window.selectedVariations[n]&&r(window.selectedVariations[n].attributes,t[n])?(window.isAllowedAddToCart?window.isAllowedAddToCart(window.selectedVariations[n],n):a.css("opacity","1"),e.length&&window.selectedVariations[n].price_html&&e.html(window.selectedVariations[n].price_html+" "+(window.selectedVariations[n].availability_html||""))):(e.length&&e.html(""),a.css("opacity","0.5"),window.selectedVariations&&window.selectedVariations[n]&&delete window.selectedVariations[n])}(e,m,i)}}var r=function(n,t){return Object.keys(n).every((function(o,a,e){return n[o]===t[o]&&t[o].length>0||0===n[o].length&&t[o].length>0}))},c=function(n){return 0===n.length||n.includes("")};i.find(".nt_add_cart_wrapper").each((function(t,o){d(n(o))})),i.on("change",".nt_woo_attribute",(function(t){d(n(this),!0)})),i.on("change",".nt_woo_quantity",(function(t){var o=n(this),a=o.data("product_id");i.find(".nt_add_to_cart_".concat(a)).attr("data-quantity",o.val())})),i.on("click",".single_add_to_cart_button",(function(t){t.preventDefault();var o=n(this),d=o.attr("data-product_id")||o.closest("td").data("product-id"),r=o.attr("data-product_type")||"simple",c=i.find('[data-product-id="'.concat(d,'"]')).find(".nt_woo_quantity").val()||o.attr("data-quantity")||1,l={product_id:d,quantity:parseInt(c),product_type:r};if("variable"===r){var s=window.selectedVariations&&window.selectedVariations[d];if(!s||!s.variation_id)return alert("Please select some product options before adding this product to your cart."),!1;if(window.isAllowedAddToCart&&!window.isAllowedAddToCart(s,d))return alert("Sorry, this product is unavailable. Please choose a different combination."),!1;l.variation_id=s.variation_id,l.attributes=s.attributes}var p={products:[l],ninja_table:e.table_id,action:"ninja_table_wp_woo_add_to_cart"},u=o.html();o.append('<span class="fooicon fooicon-loader"></span>'),n.post(window.ninja_footables.ajax_url,p).then((function(t){if(t.success){var o=t.data;o.fragments&&(o.cart_items&&(window.ninjaTableCartItems=o.cart_items),o.fragments&&o.fragments.fragments&&n(document.body).trigger("added_to_cart",[o.fragments.fragments,o.fragments.cart_hash])),a("Product added to cart successfully!","success")}else a(t.data||"Failed to add product to cart.","error")})).fail((function(n){console.error("Add to cart error:",n),a("Failed to add product to cart. Please try again.","error")})).always((function(){o.html(u)}))}))}function a(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",a='\n            <div class="comparison-message comparison-message-'.concat("success"===o?"success":"error"===o?"error":"info",'">\n                ').concat(t,"\n            </div>\n        ");n(".comparison-message").remove(),n(".nt_modal_header").after(a),setTimeout((function(){n(".comparison-message").fadeOut((function(){n(this).remove()}))}),1e3)}function e(n){if(!n)return"";var t=document.createElement("div");t.innerHTML=n;var o=t.textContent||t.innerText||"";return(o=o.replace(/\s+/g," ").trim()).length>100&&(o=o.substring(0,97)+"..."),o}window.createComparisonModal=function(o,a){var e="product_comparison_modal_"+a.table_id;n("#"+e).remove();var i='\n            <div id="'.concat(e,'" class="nt_modal_overlay">\n                <div class="nt_modal_content">\n                    <div class="nt_modal_header">\n                        <h3>Product Comparison (').concat(o.length,' products)</h3>\n                        <button class="nt_modal_close" type="button">&times;</button>\n                    </div>\n                    <div class="nt_modal_body">\n                        <div id="comparison_table_container">\n                            <div class="loading">Generating comparison...</div>\n                        </div>\n                    </div>\n                    <div class="nt_modal_footer">\n                        <button class="nt_btn nt_btn_secondary" id="close_comparison">Close</button>\n                    </div>\n                </div>\n            </div>\n        ');n("body").append(i),setTimeout((function(){t(o,a,e)}),100),n("#"+e).fadeIn(),n("#".concat(e," .nt_modal_close, #close_comparison")).on("click",(function(){n("#"+e).fadeOut((function(){n(this).remove()}))})),n("#"+e).on("click",(function(t){t.target===this&&n(this).fadeOut((function(){n(this).remove()}))})),n(document).on("keydown.comparison_modal",(function(t){27===t.keyCode&&(n("#"+e).fadeOut((function(){n(this).remove()})),n(document).off("keydown.comparison_modal"))}))},window.generateComparisonTable=t,window.setupComparisonVariationHandling=o,window.showComparisonMessage=a,window.cleanHtmlValue=e,n("#nt-comparison-modal-styles").length||n("head").append('\n        <style id="nt-comparison-modal-styles">\n        .field-button .nt_add_cart_wrapper {\n        //    text-align: center;\n        }\n        \n        .field-button a,\n        .field-button button,\n        .field-button .single_add_to_cart_button {\n            display: inline-block;\n            padding: 6px 12px;\n            text-decoration: none;\n            border-radius: 4px;\n            font-size: 12px;\n            background-color: #a46497 !important;\n            color: #fff !important;\n            border: none;\n            cursor: pointer;\n            transition: background-color 0.3s ease;\n            margin: 2px;\n        }\n        \n        .field-button a:hover,\n        .field-button button:hover,\n        .field-button .single_add_to_cart_button:hover {\n            background-color: #a46497 !important;\n        }\n        \n        .field-image {\n            text-align: center;\n        }\n        \n        .field-image img {\n            max-width: 80px;\n            max-height: 80px;\n            object-fit: cover;\n            border-radius: 4px;\n        }\n        \n        .field-html {\n            max-width: 250px;\n            word-wrap: break-word;\n        }\n        \n        .field-html * {\n            font-size: 12px !important;\n            line-height: 1.2 !important;\n        }\n        \n        .field-html select {\n            width: 100%;\n            max-width: 200px;\n            padding: 2px 4px;\n            font-size: 11px;\n        }\n        \n        .field-html input[type="number"] {\n            width: 60px;\n            padding: 2px 4px;\n            font-size: 11px;\n        }\n        \n        .comparison-message {\n            padding: 10px 25px;\n            margin: 0;\n            border-bottom: 1px solid #eee;\n            font-size: 14px;\n        }\n\n        .comparison-message-success {\n            background-color: #d4edda;\n            color: #155724;\n            border-left: 4px solid #28a745;\n        }\n\n        .comparison-message-error {\n            background-color: #f8d7da;\n            color: #721c24;\n            border-left: 4px solid #dc3545;\n        }\n\n        .comparison-message-info {\n            background-color: #d1ecf1;\n            color: #0c5460;\n            border-left: 4px solid #17a2b8;\n        }\n        \n        .nt_modal_overlay {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.6);\n            display: none;\n            z-index: 10000;\n            overflow-y: auto;\n        }\n        \n        .nt_modal_content {\n            position: relative;\n            margin: 50px auto;\n            background: white;\n            border-radius: 8px;\n            max-width: 95%;\n            width: 1200px;\n            max-height: 90vh;\n            overflow: hidden;\n            box-shadow: 0 10px 30px rgba(0,0,0,0.3);\n        }\n        \n        .nt_modal_header {\n            padding: 20px 25px;\n            border-bottom: 1px solid #eee;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            background: #f8f9fa;\n        }\n        \n        .nt_modal_header h3 {\n            margin: 0;\n            font-size: 18px;\n            color: #333;\n        }\n        \n        .nt_modal_close {\n            background: none;\n            border: none;\n            font-size: 24px;\n            cursor: pointer;\n            color: #666;\n            padding: 0;\n            width: 30px;\n            height: 30px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n        \n        .nt_modal_close:hover {\n            color: #000;\n        }\n        \n        .nt_modal_body {\n            padding: 0;\n            max-height: calc(90vh - 140px);\n            overflow: auto;\n        }\n        \n        .nt_modal_footer {\n            padding: 15px 25px;\n            border-top: 1px solid #eee;\n            text-align: right;\n            background: #f8f9fa;\n        }\n        \n        .comparison-table-wrapper {\n            overflow: auto;\n            max-height: calc(90vh - 140px);\n        }\n        \n        .nt_comparison_table {\n            width: 100%;\n            border-collapse: collapse;\n            font-size: 14px;\n        }\n        \n        .nt_comparison_table th,\n        .nt_comparison_table td {\n            padding: 12px 15px;\n            border: 1px solid #ddd;\n            text-align: left;\n            vertical-align: top;\n        }\n        \n        .nt_comparison_table th {\n            background-color: #f5f5f5;\n            font-weight: 600;\n            position: sticky;\n            top: 0;\n            z-index: 10;\n        }\n        \n        .nt_comparison_table .property-column {\n            width: 150px;\n            background-color: #f8f9fa;\n            font-weight: 600;\n            position: sticky;\n            left: 0;\n            z-index: 11;\n        }\n        \n        .nt_comparison_table .product-column {\n            min-width: 200px;\n            text-align: center;\n        }\n        \n        .product-header {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 8px;\n        }\n        \n        .product-thumb {\n            width: 60px;\n            height: 60px;\n            object-fit: cover;\n            border-radius: 4px;\n        }\n        \n        .product-title {\n            font-weight: 600;\n            font-size: 13px;\n            line-height: 1.3;\n        }\n        \n        .field-name {\n            background-color: #f8f9fa;\n            font-weight: 500;\n            position: sticky;\n            left: 0;\n            z-index: 5;\n        }\n        \n        .field-value {\n            max-width: 200px;\n            word-wrap: break-word;\n        }\n        \n        .nt_comparison_table tr:nth-child(even) {\n            background-color: #fdfdfd;\n        }\n        \n        .nt_btn {\n            padding: 10px 20px;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n            text-decoration: none;\n            display: inline-block;\n            font-size: 14px;\n            transition: all 0.2s;\n        }\n        \n        .nt_btn_secondary {\n            background: #6c757d;\n            color: white;\n        }\n        \n        .nt_btn_secondary:hover {\n            background: #545b62;\n        }\n        \n        .loading {\n            text-align: center;\n            padding: 40px;\n            color: #666;\n        }\n        \n        .no-image {\n            width: 60px;\n            height: 60px;\n            background-color: #f5f5f5;\n            border: 1px solid #ddd;\n            border-radius: 4px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 12px;\n            color: #999;\n            margin: 0 auto;\n        }\n        \n        @media (max-width: 768px) {\n            .nt_modal_content {\n                margin: 20px;\n                width: calc(100% - 40px);\n                max-height: calc(100vh - 40px);\n            }\n            \n            .nt_comparison_table th,\n            .nt_comparison_table td {\n                padding: 8px 10px;\n                font-size: 12px;\n            }\n            \n            .product-thumb {\n                width: 40px;\n                height: 40px;\n            }\n            \n            .no-image {\n                width: 40px;\n                height: 40px;\n            }\n        }\n        </style>\n    ')}));